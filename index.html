<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z53 Hebreeën Les 2 - 8 maart 2026</title>
    <style>
        :root { --bg: #fdfcf8; --primary: #2c3e50; --accent: #8e44ad; --text: #34495e; --gold: #f1c40f; }
        body { font-family: 'Georgia', serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; padding-bottom: 180px; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; margin-bottom: 30px; padding-bottom: 10px; }
        .main-header { color: var(--primary); margin: 0; font-size: 1.5rem; }
        .top-reset-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .screen { display: none; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #eee; min-height: 550px; }
        .active { display: block; animation: fadeIn 0.4s; }
        .scroll-box { background: #fffcf0; padding: 20px; border: 1px solid #ddd; line-height: 1.7; height: 450px; overflow-y: auto; border-radius: 6px; white-space: pre-wrap; }
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px; }
        
        /* Namen Feed Styling op Scherm 1 */
        .names-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; border: 1px inset #eee; min-height: 50px; }
        .name-tag { background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; animation: popIn 0.3s; }
        
        .admin-bar { position: fixed; bottom: 0; left:0; width: 100%; background: #1a1a1a; padding: 15px; display: flex; overflow-x: auto; gap: 15px; z-index: 1000; align-items: flex-start; }
        .btn-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .screen-btn { background: #444; color: white; border: none; padding: 12px 18px; border-radius: 6px; white-space: nowrap; cursor: pointer; }
        .current-btn { background: var(--accent) !important; font-weight: bold; }
        .nav-arrows { display: flex; gap: 10px; }
        .nav-arrows button { background: #333; color: white; border: 1px solid #555; border-radius: 4px; padding: 2px 8px; cursor: pointer; font-size: 10px; }
        .canvas { position: relative; height: 500px; border: 2px dashed #ccc; background: #fff; overflow: hidden; touch-action: none; margin-top: 10px; border-radius: 8px; }
        .draggable { position: absolute; padding: 10px 20px; background: white; border: 2px solid var(--primary); border-radius: 8px; cursor: move; box-shadow: 0 4px 8px rgba(0,0,0,0.1); font-size: 0.9rem; max-width: 250px; user-select: none; }
        .item-Jezus { border: 4px solid var(--gold) !important; border-radius: 30px; box-shadow: 0 0 20px rgba(241,196,15,0.5); z-index: 10; }
        
        input[type="text"] { padding: 12px; border: 1px solid #ccc; width: 80%; border-radius: 4px; font-size: 16px; margin-bottom: 10px; }
        textarea { padding: 12px; border: 1px solid #ccc; width: 98%; border-radius: 4px; font-size: 16px; font-family: inherit; margin-bottom: 10px; min-height: 150px; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header-flex">
        <h1 class="main-header">Hebreeën Les 2</h1>
        <button class="top-reset-btn" onclick="window.resetAllData()">RESET APP</button>
    </div>
    <div id="main-container"></div>
</div>

<div id="admin-bar" class="admin-bar"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot, setDoc, collection, addDoc, getDocs, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCcC2ZvkbWDuXLWSGmCpM2wfBnm65UYrbQ",
        authDomain: "z53bijbelstudie.firebaseapp.com",
        projectId: "z53bijbelstudie",
        storageBucket: "z53bijbelstudie.firebasestorage.app",
        messagingSenderId: "86708654444",
        appId: "1:86708654444:web:729295ba18f564b841a349"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const screenConfigs = {
        login: { title: 'Inloggen', type: 'input' },
        lied: { title: 'Lied', type: 'video', videoId: 'enJgkjpuqi0', lyrics: `De woestijn zal bloeien als een roos...` },
        hierarchie: { title: 'Hiërarchie', type: 'shared-drag' },
        lezen: { title: 'De Tekst', type: 'bijbel', text: `<strong>Hebreeën 3:1-19 (HSV)</strong>\n\n[1] Daarom, heilige broeders...` },
        mozes_cv: { title: '1. Mozes CV', type: 'bijbel', text: `<strong>Dienaar IN het huis</strong>\n- Prins van Egypte\n- Bevrijder van het volk` },
        woestijn_cv: { title: '2. Woestijn CV', type: 'bijbel', text: `<strong>Het Volk in de Woestijn</strong>\n- 40 jaar dwalen zonder rust` },
        mijn_cv: { title: 'Mijn CV', type: 'cv_input', placeholder: "Mijn 'Egypte':\nMijn 'Woestijn':\nMijn 'Rust':", dbCol: 'user_cvs', btnText: 'VERSTUUR NAAR MONITOR' },
        mijn_cv_live: { title: 'Mijn CV Live', type: 'cv_monitor' },
        zin_insturen: { title: 'Zin Insturen', type: 'cv_input', placeholder: "Typ hier een zin voor de psalm...", dbCol: 'psalm_zinnen', btnText: 'VOEG TOE AAN PSALM BOUWER' },
        psalm_bouwen: { title: 'Psalm Bouwer', type: 'personal-drag' },
        binnentreder_cv: { title: '3. Binnentreder CV', type: 'bijbel', text: `<strong>Deelgenoot van Christus</strong>\n- Onwrikbaar vertrouwen` }
    };

    let screenIds = Object.keys(screenConfigs);

    window.moveScreen = (id, dir) => {
        const i = screenIds.indexOf(id);
        const newI = i + dir;
        if(newI >= 0 && newI < screenIds.length) {
            [screenIds[i], screenIds[newI]] = [screenIds[newI], screenIds[i]];
            renderApp();
        }
    };

    window.sendData = async (fieldId, col, fieldName) => {
        const el = document.getElementById(fieldId);
        if (el && el.value) {
            await addDoc(collection(db, col), { [fieldName]: el.value, timestamp: Date.now() });
            el.value = "";
            if(col !== 'names') alert("Verstuurd!");
        }
    };

    window.updateRemoteScreen = async (id) => { 
        await setDoc(doc(db, "appState", "current"), { activeScreen: id }, { merge: true }); 
    };

    function renderApp() {
        const container = document.getElementById('main-container');
        const adminBar = document.getElementById('admin-bar');
        container.innerHTML = ""; adminBar.innerHTML = "";
        
        screenIds.forEach(id => {
            const s = screenConfigs[id];
            const div = document.createElement('div');
            div.id = `screen-${id}`; div.className = 'screen';
            let html = `<h2>${s.title}</h2>`;
            
            if (s.type === 'bijbel' || s.type === 'bible') html += `<div class="scroll-box">${s.text}</div>`;
            if (s.type === 'shared-drag') html += `<div id="canvas-hierarchy" class="canvas"></div>`;
            if (s.type === 'personal-drag') html += `<p><small>Sleep de zinnen om je eigen psalm te maken.</small></p><div id="canvas-psalm" class="canvas"></div>`;
            if (s.type === 'cv_input') html += `<textarea id="in-${id}" placeholder="${s.placeholder}"></textarea><button class="action-btn" onclick="sendData('in-${id}','${s.dbCol}','text')">${s.btnText}</button>`;
            if (s.type === 'cv_monitor') html += `<div id="cv-feed-container"></div>`;
            if (s.type === 'video') html += `<div class="video-grid"><div class="video-container"><iframe src="https://www.youtube.com/embed/${s.videoId}" frameborder="0"></iframe></div><div class="scroll-box">${s.lyrics}</div></div>`;
            
            if (s.type === 'input') {
                html += `<p>Welkom! Voer je naam in om deel te nemen:</p>
                         <input type="text" id="in-login" placeholder="Je naam...">
                         <button class="action-btn" onclick="sendData('in-login','names','name')">AANMELDEN</button>
                         <h3>Aanwezig:</h3>
                         <div id="names-feed" class="names-grid"></div>`;
            }

            div.innerHTML = html; container.appendChild(div);
            const group = document.createElement('div'); group.className = 'btn-group';
            group.innerHTML = `<button class="screen-btn" id="btn-${id}" onclick="updateRemoteScreen('${id}')">${s.title}</button>
                <div class="nav-arrows"><button onclick="moveScreen('${id}', -1)">◀</button><button onclick="moveScreen('${id}', 1)">▶</button></div>`;
            adminBar.appendChild(group);
        });
        initHierarchyLogic();
        initPsalmLogic();
        initNamesLogic(); // Start de live namen feed
    }

    function initNamesLogic() {
        const feed = document.getElementById('names-feed');
        if(!feed) return;
        onSnapshot(query(collection(db, "names"), orderBy("timestamp", "asc")), (snap) => {
            feed.innerHTML = snap.docs.map(d => `<span class="name-tag">${d.data().name}</span>`).join("");
        });
    }

    // ... De rest van de functies (initHierarchyLogic, initPsalmLogic, renderDraggables) blijft exact hetzelfde ...
    function initHierarchyLogic() {
        const canvas = document.getElementById('canvas-hierarchy');
        if(!canvas) return;
        const items = ['Jezus', 'Mozes', 'Koning', 'Hogepriester', 'Profeet','God', 'ik'];
        renderDraggables(canvas, items, true);
    }

    function initPsalmLogic() {
        const canvas = document.getElementById('canvas-psalm');
        if(!canvas) return;
        onSnapshot(query(collection(db, "psalm_zinnen"), orderBy("timestamp", "desc")), (snap) => {
            canvas.innerHTML = "";
            renderDraggables(canvas, snap.docs.map(d => d.data().text), false);
        });
    }

    function renderDraggables(canvas, items, isHierarchy) {
        items.forEach((txt) => {
            const el = document.createElement('div');
            el.className = `draggable ${isHierarchy && txt === 'Jezus' ? 'item-Jezus' : ''}`;
            el.innerText = txt;
            el.style.top = (50 + Math.floor(Math.random() * 300)) + 'px';
            el.style.left = (50 + Math.floor(Math.random() * 400)) + 'px';
            let isDragging = false;
            let startX, startY, origX, origY;
            const start = (e) => {
                isDragging = true; el.style.zIndex = 1000;
                const evt = e.touches ? e.touches[0] : e;
                startX = evt.clientX; startY = evt.clientY;
                origX = el.offsetLeft; origY = el.offsetTop;
            };
            const move = (e) => {
                if (!isDragging) return;
                const evt = e.touches ? e.touches[0] : e;
                el.style.left = (origX + (evt.clientX - startX)) + 'px';
                el.style.top = (origY + (evt.clientY - startY)) + 'px';
            };
            const stop = () => { isDragging = false; el.style.zIndex = (isHierarchy && txt === 'Jezus' ? 10 : 1); };
            el.addEventListener('mousedown', start); el.addEventListener('touchstart', start, {passive: false});
            window.addEventListener('mousemove', move); window.addEventListener('touchmove', move, {passive: false});
            window.addEventListener('mouseup', stop); window.addEventListener('touchend', stop);
            canvas.appendChild(el);
        });
    }

    onSnapshot(doc(db, "appState", "current"), (snap) => {
        const activeId = snap.data()?.activeScreen || 'login';
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen-${activeId}`)?.classList.add('active');
        document.querySelectorAll('.screen-btn').forEach(b => b.classList.remove('current-btn'));
        document.getElementById(`btn-${activeId}`)?.classList.add('current-btn');
    });

    onSnapshot(collection(db, "user_cvs"), (snap) => {
        const container = document.getElementById('cv-feed-container');
        if(container) container.innerHTML = snap.docs.map(d => `<div class="scroll-box" style="height:auto; font-size:0.85rem; border-left:4px solid var(--gold); background:white; margin-bottom:10px;">${d.data().text}</div>`).join("");
    });

    window.resetAllData = async () => {
        if(confirm("Alles resetten?")){
            await setDoc(doc(db, "appState", "current"), { activeScreen: 'login' });
            for(const c of ['names', 'user_cvs', 'psalm_zinnen']) {
                const q = await getDocs(collection(db, c));
                for(const d of q.docs) { await deleteDoc(doc(db, c, d.id)); }
            }
            location.reload();
        }
    };

    renderApp();
</script>
</body>
</html>
